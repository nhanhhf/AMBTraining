const urlParams=new URLSearchParams(window.location.search),configFilePath="../js/config.json";let configRespone=await fetch("../js/config.json"),configs=await configRespone.json();const moduleList=configs.moduleList,subPart=configs.subPart,index=urlParams.get("index"),subPartChosen=urlParams.get("subPart"),moduleVer=urlParams.get("mVer");var response,module,isFullTest,moduleCode=configs.moduleCode[index];if(moduleVer>0){let e=`../data/test/${moduleCode}-${moduleVer}.json`;module=await (response=await fetch(e)).json()}else{let t=`../data/test/${moduleCode}.json`;module=await (response=await fetch(t)).json()}var isFullTestRandom=!1,level3Only=0;isFullTest="0"!==subPartChosen,document.getElementById("moduleName").innerText=module.ModuleName;var descriptText1=document.getElementById("descriptText1"),QuestionList=module.Questions,CatInfo=module.CatInfos[0],requireLevel=[CatInfo.QuestionRequired[0],CatInfo.QuestionRequired[1],CatInfo.QuestionRequired[2]];let wrongAnswerAllow=.25*(requireLevel[0]+requireLevel[1]+requireLevel[2]);var questionBlock_html=document.getElementById("questionsBlock");document.getElementById("submitButton").onclick=function(){submitTest()},document.getElementById("resetButton").onclick=function(){resetTest()};var currentQuestion=ComputeNewQuestion();function submitTest(){if(!0!=confirm("Bạn muốn nộp b\xe0i?"))return;var e=Math.floor((subPartChosen-1)/subPart[index][moduleVer]*QuestionList.length+1);let t=0;for(let n=0;n<currentQuestion.length;n++){let o="Q"+e.toString();for(var l=document.getElementsByName(o),r=0,s=0;s<l.length;s++)l[s].checked&&(r=s+1);let i=currentQuestion[n].CorrectAnswer;if(r!=i){t++;let u=i-1,a="l"+e.toString()+u.toString();document.getElementById(a).classList.add("wrongAnswer")}e++}descriptText1.innerText=`Bạn đ\xe3 đ\xfang ${currentQuestion.length-t}/${currentQuestion.length} c\xe2u.`,"false"==isFullTest&&(t<=wrongAnswerAllow?descriptText1.innerText+=" Bạn đ\xe3 đạt b\xe0i thi.":descriptText1.innerText+=" Bạn chưa đạt b\xe0i thi."),window.scrollTo(0,0)}function resetTest(){!0==confirm("Bạn muốn l\xe0m b\xe0i test mới?")&&(currentQuestion=ComputeNewQuestion(),DisplayQuestion())}function ComputeNewQuestion(){var e=[];if(!0==isFullTest){var t=subPart[index][moduleVer],n=Math.floor((subPartChosen-1)/t*QuestionList.length),o=Math.floor(subPartChosen/t*QuestionList.length);if((e=QuestionList.slice(n,o)).forEach(e=>{e=SwapAnswer(e)}),-1==level3Only)for(var l=0;l<e.length;l++)3==e[l].Level&&(e.splice(l,1),l--);else if(1==level3Only)for(var l=0;l<e.length;l++)3!=e[l].Level&&(e.splice(l,1),l--);descriptText1.innerText=`Số c\xe2u hỏi: ${e.length}. C\xe2u hỏi ${n+1} - ${o}.`}return isFullTestRandom&&shuffle(e),e}function DisplayQuestion(){questionBlock_html.innerHTML="";for(var e=Math.floor((subPartChosen-1)/subPart[index][moduleVer]*QuestionList.length+1),t=0;t<currentQuestion.length;t++){let n=document.createElement("form");var o=document.createElement("p");o.className="questionString",o.innerText="C\xe2u "+e.toString()+": "+currentQuestion[t].QuestionString,questionBlock_html.appendChild(o);for(let l=0;l<3;l++){let r=document.createElement("input");r.type="radio";let s="q"+e.toString()+l.toString(),i="Q"+e.toString();r.id=s,r.value=l+1,r.name=i,n.append(r);let u=document.createElement("label");u.innerText=currentQuestion[t].Answers[l],u.htmlFor=s;let a="l"+e.toString()+l.toString();u.id=a,u.classList.add("answerString"),n.append(u),n.append(document.createElement("br"))}e++,questionBlock_html.append(n)}}function AddRandomButton(){if(isFullTest){var e=document.getElementById("buttonHeaderDiv"),t=document.createElement("button");t.id="randomStateButton",!1==isFullTestRandom?t.innerText="X\xe1o trộn c\xe2u hỏi: Tắt":t.innerText="X\xe1o trộn c\xe2u hỏi: Bật",t.classList.add("button"),t.onclick=changeRandomState,e.append(t)}}function AddRemoveLevel3Button(){var e=document.getElementById("buttonHeaderDiv"),t=document.createElement("button");t.id="level3StateButton",t.classList.add("button"),t.onclick=changeLevel3State,e.append(t),setLevel3ButtonText()}function SwapAnswer(e){let t=[[0,1,2],[0,2,1],[1,0,2],[1,2,0],[2,0,1],[2,1,0]],n=Math.floor(6*Math.random()),o=[],l;for(let r=0;r<3;r++)o.push(e.Answers[t[n][r]]),t[n][r]+1==e.CorrectAnswer&&(l=r+1);return e.Answers=o,e.CorrectAnswer=l,e}function shuffle(e){var t,n,o;for(o=e.length-1;o>0;o--)t=Math.floor(Math.random()*(o+1)),n=e[o],e[o]=e[t],e[t]=n;return e}function changeRandomState(){isFullTestRandom=!isFullTestRandom;var e=document.getElementById("randomStateButton");!1==isFullTestRandom?e.innerText="X\xe1o trộn c\xe2u hỏi: Tắt":e.innerText="X\xe1o trộn c\xe2u hỏi: Bật"}function setLevel3ButtonText(){var e=document.getElementById("level3StateButton");0==level3Only?e.innerText="Giữ level 3":-1==level3Only?e.innerText="Bỏ level 3":1==level3Only&&(e.innerText="Chỉ c\xf2n level 3")}function changeLevel3State(){level3Only=0==level3Only?-1:-1==level3Only?1:0,setLevel3ButtonText()}AddRandomButton(),AddRemoveLevel3Button(),DisplayQuestion();
